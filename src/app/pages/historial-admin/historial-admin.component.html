<div class="historial-container">

    <h2>Historial del Sistema</h2>

    <div class="tabs">
        <button class="tab" [class.active]="currentTab==='auditoria'"
            (click)="cambiarTab('auditoria')">Auditoría</button>
        <button class="tab" [class.active]="currentTab==='accesos'" (click)="cambiarTab('accesos')">Accesos</button>
    </div>

    <section class="tab-content" *ngIf="currentTab === 'auditoria'">
        <div class="header-row">
            <div>
                <h3>Acciones de administradores</h3>
                <p class="muted">Registros de creación/edición/eliminación y cambios de configuración.</p>
            </div>

            <div class="controls">
                <input type="text" placeholder="Filtrar por admin, acción, descripción..." [(ngModel)]="filtroAcciones">
                <button class="btn" (click)="descargarAccionesCSV()">Exportar CSV</button>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="loading" *ngIf="loadingAcciones">Cargando...</div>

            <table *ngIf="!loadingAcciones">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Administrador</th>
                        <th>Acción</th>
                        <th>Módulo</th>
                        <th>Descripción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let a of accionesFiltradas">
                        <td>{{ fmtFecha(a.fecha) }}</td>
                        <td>{{ a.administrador }}</td>
                        <td>{{ a.accion }}</td>
                        <td>{{ a.modulo }}</td>
                        <td>{{ a.descripcion }}</td>
                    </tr>
                    <tr *ngIf="accionesFiltradas.length === 0">
                        <td colspan="5" class="empty">No se encontraron registros.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <section class="tab-content" *ngIf="currentTab === 'accesos'">
        <div class="header-row">
            <div>
                <h3>Historial de accesos</h3>
                <p class="muted">IPs, navegador, intentos y resultados (exitoso / fallido / bloqueado).</p>
            </div>

            <div class="controls">
                <input type="text" placeholder="Filtrar por usuario, ip, navegador..." [(ngModel)]="filtroAccesos">
                <button class="btn" (click)="descargarAccesosCSV()">Exportar CSV</button>
            </div>
        </div>

        <div class="table-wrapper">
            <div class="loading" *ngIf="loadingAccesos">Cargando...</div>

            <table *ngIf="!loadingAccesos">
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>Usuario</th>
                        <th>IP</th>
                        <th>Navegador</th>
                        <th>Resultado</th>
                        <th>Intentos</th>
                        <th>Ubicación</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let r of accesosFiltrados">
                        <td>{{ fmtFecha(r.fecha) }}</td>
                        <td>{{ r.usuario }}</td>
                        <td>{{ r.ip }}</td>
                        <td>{{ r.navegador }}</td>
                        <td><span class="badge" [class.ok]="r.resultado==='exitoso'"
                                [class.warn]="r.resultado==='fallido'" [class.bad]="r.resultado==='bloqueado'">{{
                                r.resultado }}</span></td>
                        <td>{{ r.intentos }}</td>
                        <td>{{ r.ubicacion || '-' }}</td>
                    </tr>
                    <tr *ngIf="accesosFiltrados.length === 0">
                        <td colspan="7" class="empty">No se encontraron registros.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>
</div>