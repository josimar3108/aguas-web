<div class="alertas-container">

    <div class="header-section">
        <h1 class="title">Monitor de Alertas</h1>
    </div>

    <div class="filters">
        <div class="filter-item">
            <label>Tipo de Incidente</label>
            <select [(ngModel)]="filterType" (change)="applyFilters()">
                <option value="">Todos</option>
                <option value="Accidente">Accidente</option>
                <option value="Asalto">Asalto</option>
                <option value="Inundación">Inundación</option>
                <option value="Incendio">Incendio</option>
                <option value="Manifestación">Manifestación</option>
                <option value="Vialidad Cerrada">Vialidad Cerrada</option>
                <option value="Fuga de Agua">Fuga de Agua</option>
                <option value="Otro">Otro</option>
            </select>
        </div>

        <div class="filter-item search-box">
            <label>Búsqueda</label>
            <div class="input-wrapper">
                <span class="material-symbols-outlined icon">search</span>
                <input type="text" placeholder="Buscar por descripción, calle..." [(ngModel)]="searchText"
                    (input)="applyFilters()" />
                <button *ngIf="searchText || filterType" (click)="clearFilters()" class="clear-btn">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
        </div>
    </div>

    <div class="table-wrapper">

        <div class="loading-state" *ngIf="loading">
            <p>Cargando alertas en tiempo real...</p>
        </div>

        <table *ngIf="!loading">
            <thead>
                <tr>
                    <th>Tipo</th>
                    <th>Descripción</th>
                    <th>Ubicación</th>
                    <th>Clima</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                </tr>
            </thead>

            <tbody>
                <tr *ngFor="let i of filtered">
                    <td>
                        <span class="type-indicator">{{ i.type }}</span>
                    </td>

                    <td class="desc-cell" title="{{ i.description }}">
                        {{ i.description }}
                    </td>

                    <td>
                        <div class="location-cell">
                            <span class="material-symbols-outlined tiny">location_on</span>
                            {{ i.address || 'Ubicación GPS' }}
                        </div>
                    </td>

                    <td>
                        <div class="weather-cell">
                            {{ i.weather || '-' }}
                            <span class="temp" *ngIf="i.temperature">({{ i.temperature }}°C)</span>
                        </div>
                    </td>

                    <td>
                        <div class="date-cell">
                            <span class="date">{{ i.fecha | date:'dd/MM/yyyy' }}</span>
                            <span class="time">{{ i.fecha | date:'shortTime' }}</span>
                        </div>
                    </td>

                    <td>
                        <span class="tag" [ngClass]="{
                            'status-pendiente': i.status === 'PENDIENTE',
                            'status-enviado': i.status === 'ENVIADO',
                            'status-resuelto': i.status === 'ATENDIDO' || i.status === 'RESUELTO'
                        }">
                            {{ i.status || 'PENDIENTE' }}
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>

        <div *ngIf="!loading && filtered.length === 0" class="empty-state">
            <span class="material-symbols-outlined">inbox</span>
            <p>No se encontraron alertas con los filtros actuales.</p>
        </div>
    </div>
</div>