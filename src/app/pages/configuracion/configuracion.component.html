<div class="comunidad-wrapper">
    <div class="header">
        <h1>Configuraciones del Sistema</h1>
        <p class="subtitle">Administración de usuarios y respaldos</p>
    </div>

    <div class="grid">
        <div class="card">
            <h2>Gestión de Usuarios</h2>

            <div class="admin-list">
                <div class="admin-card" *ngFor="let u of usuarios"> 

                    <div class="info">
                        <div class="avatar">{{ u.nombre.charAt(0) }}</div>
                        <p class="accion">{{ u.nombre }}</p>
                        <p class="rol">{{ u.rol }}</p>
                    </div>

                    <div class="acciones">
                        <span class="status" [class.online]="u.activo"></span>

                        <button (click)="openUserModal(u)">Editar</button>
                        <button class="danger" (click)="deleteUser(u.id)">Eliminar</button>
                        <button class="warning" (click)="forcePasswordReset(u)">Reset Pass</button>
                    </div>
                </div>
            </div>

            <button class="add-user" (click)="openUserModal()">+ Nuevo Usuario</button>
        </div>

        <div class="card">
            <h2>Respaldos</h2>

            <button class="generate-backup-btn" (click)="generateBackup()">Generar Respaldo Manual</button>

            <div class="auto-backup">
                <label>
                    <input type="checkbox" [(ngModel)]="respaldoAutomatico.habilitado"> Activar respaldos automáticos
                </label>

                <div *ngIf="respaldoAutomatico.habilitado" class="auto-options">
                    <label>Frecuencia:
                        <select [(ngModel)]="respaldoAutomatico.frecuencia">
                            <option value="diario">Diario</option>
                            <option value="semanal">Semanal</option>
                        </select>
                    </label>

                    <label>Hora:
                        <input type="time" [(ngModel)]="respaldoAutomatico.hora">
                    </label>
                </div>
            </div>

            <label class="upload-btn">
                Cargar Respaldo
                <input type="file" (change)="uploadBackup($event)">
            </label>

            <ul class="logs">
                <li *ngFor="let b of copiasDeSeguridad">
                    <strong>{{ b.fecha }}</strong> — {{ b.tamano }} ({{ b.tipo }})
                    <button class="restore" (click)="restoreBackup(b)">Restaurar</button>
                </li>
            </ul>
        </div>
    </div>

    <div class="modal" *ngIf="mostrarModalUsuario">
        <div class="modal-content card">
            <h2>{{ usuarioNuevo ? 'Nuevo Usuario' : 'Editar Usuario' }}</h2>

            <label>Nombre
                <input type="text" [(ngModel)]="usuarioSeleccionado.nombre" placeholder="Nombre completo">
            </label>

            <label *ngIf="usuarioNuevo">Contraseña
                <input type="password" [(ngModel)]="passwordNuevo" placeholder="Asignar contraseña">
            </label>

            <label>Rol
                <select [(ngModel)]="usuarioSeleccionado.rol">
                    <option>Administrador</option>
                    <option>Supervisor</option>
                    <option>Operador</option>
                </select>
            </label>

            <label>
                <input type="checkbox" [(ngModel)]="usuarioSeleccionado.activo"> Usuario Activo
            </label>

            <div class="modal-actions">
                <button (click)="saveUser()">Guardar</button>
                <button class="danger" (click)="mostrarModalUsuario=false">Cancelar</button>
            </div>
        </div>
    </div>
</div>